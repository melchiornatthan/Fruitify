"use strict";var qe=Object.defineProperty,je=Object.defineProperties;var Me=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var G=(e,s,a)=>s in e?qe(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a,A=(e,s)=>{for(var a in s||(s={}))J.call(s,a)&&G(e,a,s[a]);if(M)for(var a of M(s))Q.call(s,a)&&G(e,a,s[a]);return e},T=(e,s)=>je(e,Me(s));var X=(e,s)=>{var a={};for(var f in e)J.call(e,f)&&s.indexOf(f)<0&&(a[f]=e[f]);if(e!=null&&M)for(var f of M(e))s.indexOf(f)<0&&Q.call(e,f)&&(a[f]=e[f]);return a};Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const l=require("react"),Oe=require("prop-types"),Le=require("../helpers/useId.cjs"),Se=require("@strapi/icons/CarretDown"),Re=require("@strapi/icons/Cross"),u=require("./utils.cjs"),Y=require("../Flex/Flex.cjs"),Z=require("../Select/components.cjs"),ke=require("../Popover/Popover.cjs"),we=require("../Box/Box.cjs"),ee=require("../Typography/Typography.cjs"),Ae=require("../Loader/Loader.cjs"),O=require("./components.cjs"),Te=require("./ComboboxOption.cjs"),Be=require("./ComboboxList.cjs"),$e=require("../Field/Field.cjs"),De=require("../Field/FieldLabel.cjs");require("../Field/FieldInput.cjs");const Pe=require("../Field/FieldHint.cjs"),_e=require("../Field/FieldError.cjs");require("../Field/FieldContext.cjs");require("../Field/FieldAction.cjs");const Ve=require("../Stack/Stack.cjs"),Ke=require("../helpers/keyboardKeys.cjs"),He=require("../VisuallyHidden/VisuallyHidden.cjs"),L=e=>e&&typeof e=="object"&&"default"in e?e:{default:e},n=L(l),t=L(Oe),Ne=L(Se),Ue=L(Re),I=ze=>{var V=ze,{children:e,clearLabel:s,creatable:a,createMessage:f,disabled:b,error:S,hasMoreItems:te,hint:$,label:y,labelAction:oe,loading:R,loadingMessage:ne,noOptionsMessage:re,onChange:D,onClear:P,onCreateOption:ae,onInputChange:_,onLoadMore:le,placeholder:se,required:ie,value:C}=V,ue=X(V,["children","clearLabel","creatable","createMessage","disabled","error","hasMoreItems","hint","label","labelAction","loading","loadingMessage","noOptionsMessage","onChange","onClear","onCreateOption","onInputChange","onLoadMore","placeholder","required","value"]);const ce=()=>{var o;return(o=e.find(r=>{var i;return((i=r.props)==null?void 0:i.value.toLowerCase())===C.toLowerCase()}).props)==null?void 0:o.children},[d,K]=l.useState(0),[de,fe]=l.useState(null),[m,H]=l.useState(e),[h,pe]=l.useState(!1),[c,q]=l.useState(""),v=l.useRef(),j=l.useRef(!1),F=l.useRef(),N=l.useRef(),me=l.useRef(),U=l.useRef(!0),p=Le.useId("combobox"),k=`${p}-label`;if(!y&&!ue["aria-label"])throw new Error('The Combobox component needs a "label" or an "aria-label" props');l.useEffect(()=>{H(u.filterOptions(e,c))},[c,e]),l.useEffect(()=>{h&&v.current&&u.maintainScrollVisibility(v.current)},[d]),l.useLayoutEffect(()=>{if(U.current){U.current=!1;return}},[C]);const be=h?`${p}-${d}`:"",z=()=>{D(null),q("")},Ce=o=>{_&&_(o);const r=F.current.value;H(u.filterOptions(e,r)),K(0),fe(null),c!==r&&q(r),h||g(!0,!1)},ge=o=>{const{key:r}=o,i=a&&c?m.length:m.length-1,E=u.getActionFromKey(r,h);switch(C&&!c&&r===Ke.KeyboardKeys.BACKSPACE&&z(),E){case u.MenuActions.Next:return x(d===i?0:u.getUpdatedIndex(d,i,E));case u.MenuActions.Previous:return x(d===0?i:u.getUpdatedIndex(d,i,E));case u.MenuActions.Last:case u.MenuActions.First:return x(d===i?0:u.getUpdatedIndex(d,i,E));case u.MenuActions.CloseSelect:o.preventDefault(),w(d);return;case u.MenuActions.Close:return o.preventDefault(),g(!1);case u.MenuActions.Open:return g(!0);default:return}},xe=o=>{if(o.preventDefault(),C&&!j.current&&q(""),j.current){j.current=!1;return}g(!1,!1)},x=o=>{K(o)},ye=o=>{x(o),w(o)},W=()=>{j.current=!0},w=o=>{const r=m[o];if(q(""),r)return D(r.props.value),g(!1);a&&(ae(c),g(!1))},g=(o,r=!0)=>{pe(o),r&&F.current.focus()},he=l.Children.toArray(m).map((o,r)=>{const i=d===r;return l.cloneElement(o,{id:`${p}-${r}`,"aria-selected":de===r,"aria-posinset":r+1,"aria-setsize":l.Children.toArray(m).length,ref:E=>{i&&(v.current=E)},onClick:()=>ye(r),onMouseDown:W,isSelected:i})}),ve=()=>{F.current.focus(),P&&P(),z()},Ee=()=>{F.current.focus(),g(!0)},Fe=()=>{const o=m.findIndex(r=>{var i;return((i=r.props)==null?void 0:i.children)===c});return c&&o===-1},Ie=o=>{o.preventDefault(),g(o,!0)};return n.default.createElement($e.Field,{hint:$,error:S,id:p},n.default.createElement(He.VisuallyHidden,{"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text"},C),n.default.createElement(Ve.Stack,{spacing:y||$||S?1:0},y&&n.default.createElement(De.FieldLabel,{action:oe,required:ie,id:k},y),n.default.createElement(O.MainRow,{ref:N,$disabled:b,hasError:S},n.default.createElement(O.InputContainer,{wrap:"wrap"},!c&&C&&n.default.createElement(O.ValueContainer,{id:`${p}-selected-value`},n.default.createElement(ee.Typography,null,ce())),n.default.createElement(O.Input,{"aria-activedescendant":be,"aria-autocomplete":"list","aria-controls":`${p}-listbox`,"aria-disabled":b,"aria-expanded":h,"aria-haspopup":"listbox","aria-labelledby":y?k:void 0,id:p,onBlur:b?void 0:xe,onClick:b?void 0:Ie,onInput:b?void 0:Ce,onKeyDown:b?void 0:ge,placeholder:C?"":se,readOnly:b,ref:F,role:"combobox",autoComplete:"off",autoCorrect:"off",spellCheck:"off",type:"text",value:c})),n.default.createElement(Y.Flex,null,(C||c)&&n.default.createElement(Z.IconBox,{id:`${p}-clear`,"aria-label":s,disabled:b,paddingLeft:3,as:"button",onClick:ve,type:"button"},n.default.createElement(Ue.default,null)),n.default.createElement(Z.CaretBox,{disabled:b,paddingLeft:3,"aria-hidden":!0,as:"button",onClick:Ee,tabIndex:-1,type:"button"},n.default.createElement(Ne.default,null)))),n.default.createElement(Pe.FieldHint,null),n.default.createElement(_e.FieldError,null)),h&&n.default.createElement(ke.Popover,{id:`${p}-popover`,source:N,spacing:4,fullWidth:!0,intersectionId:`${p}-listbox-popover-intersection`,onReachEnd:te&&!R?le:void 0},n.default.createElement("div",{role:"listbox",ref:me,id:`${p}-listbox`,"aria-labelledby":y?k:void 0},(Boolean(m.length)||a)&&n.default.createElement(n.default.Fragment,null,n.default.createElement(Be.ComboboxList,{activeOptionRef:v,options:he}),Fe()&&a&&n.default.createElement(Te.ComboboxOption,{isSelected:d===m.length,ref:o=>{d===m.length&&(v.current=o)},onMouseDown:W,onClick:()=>w(),taindex:0},f(c))),!Boolean(m.length)&&!a&&!R&&n.default.createElement(we.Box,{paddingLeft:4,paddingRight:4,paddingTop:2,paddingBottom:2,ref:v},n.default.createElement(ee.Typography,{textColor:"neutral800"},re(c))),R&&n.default.createElement(Y.Flex,{justifyContent:"center",alignItems:"center",paddingTop:2,paddingBottom:2},n.default.createElement(Ae.Loader,{small:!0},ne)))))},B=e=>n.default.createElement(I,T(A({},e),{creatable:!0}));I.defaultProps=B.defaultProps={"aria-label":void 0,clearLabel:"clear",creatable:!1,createMessage:e=>`Create "${e}"`,disabled:!1,error:void 0,hasMoreItems:!1,hint:void 0,label:void 0,loading:!1,loadingMessage:"Loading content...",noOptionsMessage:()=>"No results found",onClear:void 0,onCreateOption:void 0,onInputChange:void 0,onLoadMore:void 0,placeholder:"Select or enter a value",value:void 0};I.propTypes={"aria-label":t.default.string,children:t.default.oneOfType([t.default.arrayOf(t.default.node),t.default.node]),clearLabel:t.default.string,creatable:t.default.bool,createMessage:t.default.func,disabled:t.default.bool,error:t.default.string,hasMoreItems:t.default.bool,hint:t.default.oneOfType([t.default.string,t.default.node,t.default.arrayOf(t.default.node)]),label:t.default.string,labelAction:t.default.element,loading:t.default.bool,loadingMessage:t.default.string,noOptionsMessage:t.default.func,onChange:t.default.func.isRequired,onClear:t.default.func,onCreateOption:t.default.func,onInputChange:t.default.func,onLoadMore:t.default.func,placeholder:t.default.string,value:t.default.string};B.propTypes=T(A({},I.propTypes),{onCreateOption:t.default.func.isRequired});exports.Combobox=I;exports.CreatableCombobox=B;
