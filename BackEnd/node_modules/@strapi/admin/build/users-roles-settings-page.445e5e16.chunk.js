"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[8853],{50832:(re,F,o)=>{o.r(F),o.d(F,{default:()=>Lr});var r=o(32735),R=o(5141),m=o(88425),C=o(90201),b=o(88369),I=o(41415),K=o(96709),v=o(28356),T=o(99223),D=o(17e3),Z=o(27649),N=o(56755),_=o(33827),x=o(94547),E=o(19786),U=o(3685),f=o(88860),et=o(94638),tt=o(19406),j=o(5636),Y=o(84968),st=o(58469),B=o(59677),ne=(s,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(s,e)).next())});const rt=(s,e)=>ne(void 0,null,function*(){try{const{data:t}=yield B.be.get((0,B.Gc)("roles"));return e("The roles have loaded successfully"),t}catch(t){throw s({type:"warning",message:{id:"notification.error"}}),new Error("error")}}),nt=(s,e)=>ne(void 0,null,function*(){try{yield B.be.delete(`${(0,B.Gc)("roles")}/${s}`)}catch(t){e({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}});var ot=o(60216),h=o.n(ot),oe=o(50563),J=o(36320),at=o(35658),it=o(68625),lt=o(4038),ct=Object.defineProperty,ae=Object.getOwnPropertySymbols,ut=Object.prototype.hasOwnProperty,dt=Object.prototype.propertyIsEnumerable,ie=(s,e,t)=>e in s?ct(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,le=(s,e)=>{for(var t in e||(e={}))ut.call(e,t)&&ie(s,t,e[t]);if(ae)for(var t of ae(e))dt.call(e,t)&&ie(s,t,e[t]);return s};const q=({sortedRoles:s,canDelete:e,permissions:t,setRoleToDelete:i,onDelete:u})=>{const{formatMessage:l}=(0,j.useIntl)(),{push:d}=(0,R.useHistory)(),[a,n]=u,c=p=>e&&!["public","authenticated"].includes(p.type),g=p=>{i(p),n(!a)},P=p=>{d(`/settings/${C.Z}/roles/${p}`)};return r.createElement(at.p,null,s==null?void 0:s.map(p=>r.createElement(x.Tr,le({key:p.name},(0,m.onRowClick)({fn:()=>P(p.id)})),r.createElement(E.Td,{width:"20%"},r.createElement(f.Z,null,p.name)),r.createElement(E.Td,{width:"50%"},r.createElement(f.Z,null,p.description)),r.createElement(E.Td,{width:"30%"},r.createElement(f.Z,null,`${p.nb_users} ${l({id:"global.users",defaultMessage:"users"}).toLowerCase()}`)),r.createElement(E.Td,null,r.createElement(J.k,le({justifyContent:"end"},m.stopPropagation),r.createElement(m.CheckPermissions,{permissions:t.updateRole},r.createElement(oe.h,{onClick:()=>P(p.id),noBorder:!0,icon:r.createElement(it.Z,null),label:l({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${p.name}`})})),c(p)&&r.createElement(m.CheckPermissions,{permissions:t.deleteRole},r.createElement(oe.h,{onClick:()=>g(p.id),noBorder:!0,icon:r.createElement(lt.default,null),label:l({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${p.name}`})})))))))},mt=q;q.defaultProps={canDelete:!1},q.propTypes={onDelete:h().array.isRequired,permissions:h().object.isRequired,setRoleToDelete:h().func.isRequired,sortedRoles:h().array.isRequired,canDelete:h().bool};var ce=(s,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(s,e)).next())});const pt=()=>{const{trackUsage:s}=(0,m.useTracking)(),{formatMessage:e}=(0,j.useIntl)(),{push:t}=(0,R.useHistory)(),i=(0,m.useNotification)(),{notifyStatus:u}=(0,et.G)(),[{query:l}]=(0,m.useQueryParams)(),d=(l==null?void 0:l._q)||"",[a,n]=(0,r.useState)(!1),[c,g]=(0,r.useState)(!1),[P,p]=(0,r.useState)();(0,m.useFocusWhenNavigate)();const O=(0,Y.useQueryClient)(),y=(0,r.useMemo)(()=>({create:b.Z.createRole,read:b.Z.readRoles,update:b.Z.updateRole,delete:b.Z.deleteRole}),[]),{isLoading:L,allowedActions:{canRead:w,canDelete:k}}=(0,m.useRBAC)(y),{isLoading:wr,data:{roles:se},isFetching:Sr}=(0,Y.useQuery)("get-roles",()=>rt(i,u),{initialData:{},enabled:w}),qe=wr||Sr,Mr=()=>{s("willCreateRole"),t(`/settings/${C.Z}/roles/new`)},Ur=()=>{n(!a)},jr={roles:{id:(0,B.OB)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,B.OB)("Roles.empty.search"),defaultMessage:"No roles match the search."}},Ir=e({id:"global.roles",defaultMessage:"Roles"}),Zr=(0,Y.useMutation)(Fr=>nt(Fr,i),{onSuccess(){return ce(this,null,function*(){yield O.invalidateQueries("get-roles")})}}),Nr=()=>ce(void 0,null,function*(){g(!0),yield Zr.mutateAsync(P),n(!a),g(!1)}),W=(0,st.ZP)(se||[],d,{keys:["name","description"]}),xr=d&&!W.length?"search":"roles",Br=4,Gr=((se==null?void 0:se.length)||0)+1;return r.createElement(K.A,null,r.createElement(m.SettingsPageTitle,{name:Ir}),r.createElement(Z.o,{"aria-busy":qe},r.createElement(v.T,{title:e({id:"global.roles",defaultMessage:"Roles"}),subtitle:e({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:r.createElement(m.CheckPermissions,{permissions:b.Z.createRole},r.createElement(I.z,{onClick:Mr,startIcon:r.createElement(tt.default,null),size:"S"},e({id:(0,B.OB)("List.button.roles"),defaultMessage:"Add new role"})))}),r.createElement(T.Z,{startActions:r.createElement(m.SearchURLQuery,{label:e({id:"app.component.search.label",defaultMessage:"Search"})})}),r.createElement(D.D,null,!w&&r.createElement(m.NoPermissions,null),(qe||L)&&r.createElement(m.LoadingIndicatorPage,null),w&&W&&(W==null?void 0:W.length)?r.createElement(N.i,{colCount:Br,rowCount:Gr},r.createElement(_.h,null,r.createElement(x.Tr,null,r.createElement(E.Th,null,r.createElement(f.Z,{variant:"sigma",textColor:"neutral600"},e({id:"global.name",defaultMessage:"Name"}))),r.createElement(E.Th,null,r.createElement(f.Z,{variant:"sigma",textColor:"neutral600"},e({id:"global.description",defaultMessage:"Description"}))),r.createElement(E.Th,null,r.createElement(f.Z,{variant:"sigma",textColor:"neutral600"},e({id:"global.users",defaultMessage:"Users"}))),r.createElement(E.Th,null,r.createElement(U.T,null,e({id:"global.actions",defaultMessage:"Actions"}))))),r.createElement(mt,{sortedRoles:W,canDelete:k,permissions:b.Z,setRoleToDelete:p,onDelete:[a,n]})):r.createElement(m.EmptyStateLayout,{content:jr[xr]})),r.createElement(m.ConfirmDialog,{isConfirmButtonLoading:c,onConfirm:Nr,onToggleDialog:Ur,isOpen:a})))},gt=()=>r.createElement(m.CheckPagePermissions,{permissions:b.Z.accessRoles},r.createElement(pt,null));var ue=o(83281),A=o(27677),S=o(62345),de=o(10369),me=o(10508),ft=o(29439),pe=o(66456),H=o(15335),G=o(5803),$=o(82069),M=o(92891);const ge=(0,r.createContext)({}),fe=({children:s,value:e})=>r.createElement(ge.Provider,{value:e},s),ee=()=>(0,r.useContext)(ge);fe.propTypes={children:h().node.isRequired,value:h().object.isRequired};var z=o(83292),Pt=o(37213),vt=o.n(Pt),Et=o(15738),ht=o.n(Et);const yt=s=>{switch(s){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Ot=(0,z.default)(S.x)`
  margin: -1px;
  border-radius: ${({theme:s})=>s.spaces[1]} 0 0 ${({theme:s})=>s.spaces[1]};
`;function te({route:s}){const{formatMessage:e}=(0,j.useIntl)(),{method:t,handler:i,path:u}=s,l=u?ht()(u.split("/")):[],[d="",a=""]=i?i.split("."):[],n=yt(s.method);return r.createElement(A.K,{spacing:2},r.createElement(f.Z,{variant:"delta",as:"h3"},e({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",r.createElement("span",null,d),r.createElement(f.Z,{variant:"delta",textColor:"primary600"},".",a)),r.createElement(A.K,{horizontal:!0,hasRadius:!0,background:"neutral0",borderColor:"neutral200",spacing:0},r.createElement(Ot,{background:n.background,borderColor:n.border,padding:2},r.createElement(f.Z,{fontWeight:"bold",textColor:n.text},t)),r.createElement(S.x,{paddingLeft:2,paddingRight:2},vt()(l,c=>r.createElement(f.Z,{key:c,textColor:c.includes(":")?"neutral600":"neutral900"},"/",c)))))}te.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},te.propTypes={route:h().shape({handler:h().string,method:h().string,path:h().string})};const Rt=te,Ct=()=>{const{formatMessage:s}=(0,j.useIntl)(),{selectedAction:e,routes:t}=ee(),i=(0,M.without)(e.split("."),"controllers"),u=(0,M.get)(t,i[0]),l=i.slice(1).join("."),d=(0,M.isEmpty)(u)?[]:u.filter(a=>a.handler.endsWith(l));return r.createElement(G.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},e?r.createElement(A.K,{spacing:2},d.map((a,n)=>r.createElement(Rt,{key:n,route:a}))):r.createElement(A.K,{spacing:2},r.createElement(f.Z,{variant:"delta",as:"h3"},s({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})),r.createElement(f.Z,{as:"p",textColor:"neutral600"},s({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))};var bt=o(83828),Dt=o(61762),Tt=o(89966),At=o(23940),Lt=o.n(At);function wt(s){switch(s){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return Lt()(s.replace("api::","").replace("plugin::",""))}}const St=wt;var Mt=o(98978),Pe=o.n(Mt),ve=o(8284),Ut=o(45112);const Ee=z.css`
  background: ${s=>s.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,jt=(0,z.default)(S.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${s=>s.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${s=>s.isActive&&Ee}
  &:hover {
    ${Ee}
  }
`,It=z.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:s})=>s.colors.neutral150};
`,he=({subCategory:s})=>{const{formatMessage:e}=(0,j.useIntl)(),{onChange:t,onChangeSelectAll:i,onSelectedAction:u,selectedAction:l,modifiedData:d}=ee(),a=(0,r.useMemo)(()=>(0,M.get)(d,s.name,{}),[d,s]),n=(0,r.useMemo)(()=>Object.values(a).every(p=>p.enabled===!0),[a]),c=(0,r.useMemo)(()=>Object.values(a).some(p=>p.enabled===!0)&&!n,[a,n]),g=(0,r.useCallback)(({target:{name:p}})=>{i({target:{name:p,value:!n}})},[n,i]),P=(0,r.useCallback)(p=>l===p,[l]);return r.createElement(S.x,null,r.createElement(J.k,{justifyContent:"space-between",alignItems:"center"},r.createElement(S.x,{paddingRight:4},r.createElement(f.Z,{variant:"sigma",textColor:"neutral600"},s.label)),r.createElement(It,null),r.createElement(S.x,{paddingLeft:4},r.createElement(ve.X,{name:s.name,value:n,onValueChange:p=>g({target:{name:s.name,value:p}}),indeterminate:c},e({id:"app.utils.select-all",defaultMessage:"Select all"})))),r.createElement(J.k,{paddingTop:6,paddingBottom:6},r.createElement(H.r,{gap:2,style:{flex:1}},s.actions.map(p=>{const O=`${p.name}.enabled`;return r.createElement(G.P,{col:6,key:p.name},r.createElement(jt,{isActive:P(p.name),padding:2,hasRadius:!0},r.createElement(ve.X,{value:(0,M.get)(d,O,!1),name:O,onValueChange:y=>t({target:{name:O,value:y}})},p.label),r.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>u(p.name),style:{display:"inline-flex",alignItems:"center"}},r.createElement(Ut.Z,null))))}))))};he.propTypes={subCategory:h().object.isRequired};const Zt=he;var Nt=Object.defineProperty,xt=Object.defineProperties,Bt=Object.getOwnPropertyDescriptors,ye=Object.getOwnPropertySymbols,Gt=Object.prototype.hasOwnProperty,Ft=Object.prototype.propertyIsEnumerable,Oe=(s,e,t)=>e in s?Nt(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,_t=(s,e)=>{for(var t in e||(e={}))Gt.call(e,t)&&Oe(s,t,e[t]);if(ye)for(var t of ye(e))Ft.call(e,t)&&Oe(s,t,e[t]);return s},$t=(s,e)=>xt(s,Bt(e));const Re=({name:s,permissions:e})=>{const t=(0,r.useMemo)(()=>Pe()(Object.values(e.controllers).reduce((i,u,l)=>{const d=`${s}.controllers.${Object.keys(e.controllers)[l]}`,a=Pe()(Object.keys(u).reduce((n,c)=>[...n,$t(_t({},u[c]),{label:c,name:`${d}.${c}`})],[]),"label");return[...i,{actions:a,label:Object.keys(e.controllers)[l],name:d}]},[]),"label"),[s,e]);return r.createElement(S.x,{padding:6},t.map(i=>r.createElement(Zt,{key:i.name,subCategory:i})))};Re.propTypes={name:h().string.isRequired,permissions:h().object.isRequired};const Vt=Re;var kt=Object.defineProperty,Kt=Object.defineProperties,Wt=Object.getOwnPropertyDescriptors,Ce=Object.getOwnPropertySymbols,Ht=Object.prototype.hasOwnProperty,zt=Object.prototype.propertyIsEnumerable,be=(s,e,t)=>e in s?kt(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Qt=(s,e)=>{for(var t in e||(e={}))Ht.call(e,t)&&be(s,t,e[t]);if(Ce)for(var t of Ce(e))zt.call(e,t)&&be(s,t,e[t]);return s},Xt=(s,e)=>Kt(s,Wt(e));const Yt=(s,e)=>{const t=Object.keys(e).sort().map(i=>({name:i,isOpen:!1}));return Xt(Qt({},s),{collapses:t})};var Q=o(97889),Jt=Object.defineProperty,qt=Object.defineProperties,es=Object.getOwnPropertyDescriptors,De=Object.getOwnPropertySymbols,ts=Object.prototype.hasOwnProperty,ss=Object.prototype.propertyIsEnumerable,Te=(s,e,t)=>e in s?Jt(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ae=(s,e)=>{for(var t in e||(e={}))ts.call(e,t)&&Te(s,t,e[t]);if(De)for(var t of De(e))ss.call(e,t)&&Te(s,t,e[t]);return s},Le=(s,e)=>qt(s,es(e));const rs={collapses:[]},ns=(s,e)=>(0,Q.default)(s,t=>{switch(e.type){case"TOGGLE_COLLAPSE":{t.collapses=s.collapses.map((i,u)=>u===e.index?Le(Ae({},i),{isOpen:!i.isOpen}):Le(Ae({},i),{isOpen:!1}));break}default:return t}}),os=()=>{const{modifiedData:s}=ee(),{formatMessage:e}=(0,j.useIntl)(),[{collapses:t},i]=(0,r.useReducer)(ns,rs,l=>Yt(l,s)),u=l=>i({type:"TOGGLE_COLLAPSE",index:l});return r.createElement(A.K,{spacing:1},t.map((l,d)=>r.createElement(bt.U,{expanded:l.isOpen,onToggle:()=>u(d),key:l.name,variant:d%2===0?"secondary":void 0},r.createElement(Dt.B,{title:St(l.name),description:e({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:l.name}),variant:d%2?"primary":"secondary"}),r.createElement(Tt.v,null,r.createElement(S.x,null,r.createElement(Vt,{permissions:s[l.name],name:l.name}))))))};var as=Object.defineProperty,is=Object.defineProperties,ls=Object.getOwnPropertyDescriptors,we=Object.getOwnPropertySymbols,cs=Object.prototype.hasOwnProperty,us=Object.prototype.propertyIsEnumerable,Se=(s,e,t)=>e in s?as(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ds=(s,e)=>{for(var t in e||(e={}))cs.call(e,t)&&Se(s,t,e[t]);if(we)for(var t of we(e))us.call(e,t)&&Se(s,t,e[t]);return s},ms=(s,e)=>is(s,ls(e));const ps={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},gs=(s,e)=>(0,Q.default)(s,t=>{switch(e.type){case"ON_CHANGE":{const i=e.keys.length,u=e.keys[i-1]==="enabled";if(e.value&&u){const l=(0,M.take)(e.keys,i-1).join(".");t.selectedAction=l}(0,M.set)(t,["modifiedData",...e.keys],e.value);break}case"ON_CHANGE_SELECT_ALL":{const i=["modifiedData",...e.keys],u=(0,M.get)(s,i,{}),l=Object.keys(u).reduce((d,a)=>(d[a]=ms(ds({},u[a]),{enabled:e.value}),d),{});(0,M.set)(t,i,l);break}case"ON_RESET":{t.modifiedData=s.initialData;break}case"ON_SUBMIT_SUCCEEDED":{t.initialData=s.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:i}=e;t.selectedAction=i===s.selectedAction?"":i;break}default:return t}});var fs=Object.defineProperty,Ps=Object.defineProperties,vs=Object.getOwnPropertyDescriptors,Me=Object.getOwnPropertySymbols,Es=Object.prototype.hasOwnProperty,hs=Object.prototype.propertyIsEnumerable,Ue=(s,e,t)=>e in s?fs(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ys=(s,e)=>{for(var t in e||(e={}))Es.call(e,t)&&Ue(s,t,e[t]);if(Me)for(var t of Me(e))hs.call(e,t)&&Ue(s,t,e[t]);return s},Os=(s,e)=>Ps(s,vs(e));const Rs=(s,e,t)=>Os(ys({},s),{initialData:e,modifiedData:e,routes:t});var Cs=Object.defineProperty,bs=Object.defineProperties,Ds=Object.getOwnPropertyDescriptors,je=Object.getOwnPropertySymbols,Ts=Object.prototype.hasOwnProperty,As=Object.prototype.propertyIsEnumerable,Ie=(s,e,t)=>e in s?Cs(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ls=(s,e)=>{for(var t in e||(e={}))Ts.call(e,t)&&Ie(s,t,e[t]);if(je)for(var t of je(e))As.call(e,t)&&Ie(s,t,e[t]);return s},ws=(s,e)=>bs(s,Ds(e));const Ze=(0,r.forwardRef)(({permissions:s,routes:e},t)=>{const{formatMessage:i}=(0,j.useIntl)(),[u,l]=(0,r.useReducer)(gs,ps,g=>Rs(g,s,e));(0,r.useImperativeHandle)(t,()=>({getPermissions(){return{permissions:u.modifiedData}},resetForm(){l({type:"ON_RESET"})},setFormAfterSubmit(){l({type:"ON_SUBMIT_SUCCEEDED"})}}));const d=({target:{name:g,value:P}})=>l({type:"ON_CHANGE",keys:g.split("."),value:P==="empty__string_value"?"":P}),a=({target:{name:g,value:P}})=>l({type:"ON_CHANGE_SELECT_ALL",keys:g.split("."),value:P}),n=g=>l({type:"SELECT_ACTION",actionToSelect:g}),c=ws(Ls({},u),{onChange:d,onChangeSelectAll:a,onSelectedAction:n});return r.createElement(fe,{value:c},r.createElement(H.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},r.createElement(G.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},r.createElement(A.K,{spacing:6},r.createElement(A.K,{spacing:2},r.createElement(f.Z,{variant:"delta",as:"h2"},i({id:(0,$.Z)("Plugins.header.title"),defaultMessage:"Permissions"})),r.createElement(f.Z,{as:"p",textColor:"neutral600"},i({id:(0,$.Z)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."}))),r.createElement(os,null))),r.createElement(Ct,null)))});Ze.propTypes={permissions:h().object.isRequired,routes:h().object.isRequired};const Ne=(0,r.memo)(Ze),Xr={isLoading:!0,modifiedData:{}},Yr=(s,e)=>produce(s,t=>{switch(e.type){case"GET_DATA":{t.isLoading=!0,t.modifiedData={};break}case"GET_DATA_SUCCEEDED":{t.isLoading=!1,t.modifiedData=e.data;break}case"GET_DATA_ERROR":{t.isLoading=!0;break}case"ON_SUBMIT_SUCCEEDED":{t.modifiedData=e.data;break}default:return t}}),Jr=null;var Ss=o(98399),Ms=(s,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(s,e)).next())});const qr=(s,e)=>{const{isLoading:t,allowedActions:i}=useRBAC(e),[{isLoading:u,modifiedData:l},d]=useReducer(reducer,initialState),a=useNotification(),n=useRef(!0),c=new AbortController,{signal:g}=c;useEffect(()=>(t||(()=>Ms(void 0,null,function*(){try{d({type:"GET_DATA"});const O=yield request(getRequestURL(s),{method:"GET",signal:g});d({type:"GET_DATA_SUCCEEDED",data:O})}catch(O){n.current&&(d({type:"GET_DATA_ERROR"}),Ss.error(O),a({type:"warning",message:{id:"notification.error"}}))}}))(),()=>{c.abort(),n.current=!1}),[t,s]);const P=useCallback(p=>{d({type:"ON_SUBMIT_SUCCEEDED",data:p})},[]);return{allowedActions:i,dispatchSubmitSucceeded:P,isLoading:u,isLoadingForPermissions:t,modifiedData:l}},en=null;var Us=Object.defineProperty,js=Object.defineProperties,Is=Object.getOwnPropertyDescriptors,xe=Object.getOwnPropertySymbols,Zs=Object.prototype.hasOwnProperty,Ns=Object.prototype.propertyIsEnumerable,Be=(s,e,t)=>e in s?Us(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,xs=(s,e)=>{for(var t in e||(e={}))Zs.call(e,t)&&Be(s,t,e[t]);if(xe)for(var t of xe(e))Ns.call(e,t)&&Be(s,t,e[t]);return s},Bs=(s,e)=>js(s,Is(e));const tn=(s,e)=>Bs(xs({},s),{isLoading:e}),sn=null,rn={roles:[],isLoading:!0},nn=(s,e)=>produce(s,t=>{switch(e.type){case"GET_DATA":{t.isLoading=!0,t.roles=[];break}case"GET_DATA_SUCCEEDED":{t.roles=e.data,t.isLoading=!1;break}case"GET_DATA_ERROR":{t.isLoading=!1;break}default:return t}}),on=null;var Gs=(s,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(s,e)).next())});const an=(s=!0)=>{const[{roles:e,isLoading:t},i]=useReducer(reducer,initialState,()=>init(initialState,s)),u=useNotification(),l=useRef(!0),d=new AbortController,{signal:a}=d;useEffect(()=>(s&&n(),()=>{d.abort(),l.current=!1}),[s]);const n=()=>Gs(void 0,null,function*(){try{i({type:"GET_DATA"});const{roles:c}=yield request(`/${pluginId}/roles`,{method:"GET",signal:a});i({type:"GET_DATA_SUCCEEDED",data:c})}catch(c){const g=get(c,["response","payload","message"],"An error occured");l.current&&(i({type:"GET_DATA_ERROR"}),g!=="Forbidden"&&u({type:"warning",message:g}))}});return{roles:e,isLoading:t,getData:n}},ln=null;var Fs=Object.defineProperty,_s=Object.defineProperties,$s=Object.getOwnPropertyDescriptors,Ge=Object.getOwnPropertySymbols,Vs=Object.prototype.hasOwnProperty,ks=Object.prototype.propertyIsEnumerable,Fe=(s,e,t)=>e in s?Fs(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ks=(s,e)=>{for(var t in e||(e={}))Vs.call(e,t)&&Fe(s,t,e[t]);if(Ge)for(var t of Ge(e))ks.call(e,t)&&Fe(s,t,e[t]);return s},Ws=(s,e)=>_s(s,$s(e));const Hs=(s,e)=>Ws(Ks({},s),{isLoading:e});var X=o(8917);const _e={permissions:{},routes:{},isLoading:!0},zs=(s,e)=>(0,Q.default)(s,t=>{switch(e.type){case"GET_DATA":{t.isLoading=!0,t.permissions={},t.routes={};break}case"GET_DATA_SUCCEEDED":{t.permissions=e.permissions,t.routes=e.routes,t.isLoading=!1;break}case"GET_DATA_ERROR":{t.isLoading=!1;break}default:return t}});var $e=(s,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(s,e)).next())});const Ve=(s=!0)=>{const e=(0,m.useNotification)(),[{permissions:t,routes:i,isLoading:u},l]=(0,r.useReducer)(zs,_e,()=>Hs(_e,s)),d=(0,r.useCallback)(()=>$e(void 0,null,function*(){try{l({type:"GET_DATA"});const[{permissions:a},{routes:n}]=yield Promise.all([`/${C.Z}/permissions`,`/${C.Z}/routes`].map(c=>$e(void 0,null,function*(){return(yield X.Z.get(c)).data})));l({type:"GET_DATA_SUCCEEDED",permissions:(0,B.YX)(a),routes:n})}catch(a){const n=(0,M.get)(a,["response","payload","message"],"An error occured");l({type:"GET_DATA_ERROR"}),n!=="Forbidden"&&e({type:"warning",message:n})}}),[e]);return(0,r.useEffect)(()=>{s&&d()},[d,s]),{permissions:t,routes:i,getData:d,isLoading:u}},Qs={role:{},isLoading:!0},Xs=(s,e)=>(0,Q.default)(s,t=>{switch(e.type){case"GET_DATA_SUCCEEDED":{t.role=e.role,t.isLoading=!1;break}case"GET_DATA_ERROR":{t.isLoading=!1;break}case"ON_SUBMIT_SUCCEEDED":{t.role.name=e.name,t.role.description=e.description;break}default:return t}});var Ys=o(98399),Js=Object.defineProperty,qs=Object.defineProperties,er=Object.getOwnPropertyDescriptors,ke=Object.getOwnPropertySymbols,tr=Object.prototype.hasOwnProperty,sr=Object.prototype.propertyIsEnumerable,Ke=(s,e,t)=>e in s?Js(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,We=(s,e)=>{for(var t in e||(e={}))tr.call(e,t)&&Ke(s,t,e[t]);if(ke)for(var t of ke(e))sr.call(e,t)&&Ke(s,t,e[t]);return s},rr=(s,e)=>qs(s,er(e)),nr=(s,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(s,e)).next())});const or=s=>{const[e,t]=(0,r.useReducer)(Xs,Qs),i=(0,m.useNotification)(),u=(0,r.useRef)(null);(0,r.useEffect)(()=>(u.current=!0,s?l(s):t({type:"GET_DATA_SUCCEEDED",role:{}}),()=>u.current=!1),[s]);const l=a=>nr(void 0,null,function*(){try{const{data:{role:n}}=yield X.Z.get(`/${C.Z}/roles/${a}`);u.current&&t({type:"GET_DATA_SUCCEEDED",role:n})}catch(n){Ys.error(n),t({type:"GET_DATA_ERROR"}),i({type:"warning",message:{id:"notification.error"}})}}),d=(0,r.useCallback)(a=>{t(We({type:"ON_SUBMIT_SUCCEEDED"},a))},[]);return rr(We({},e),{onSubmitSucceeded:d})};var V=o(5173);const ar=V.Ry().shape({name:V.Z_().required(m.translatedErrors.required),description:V.Z_().required(m.translatedErrors.required)});var ir=o(98399),lr=Object.defineProperty,cr=Object.defineProperties,ur=Object.getOwnPropertyDescriptors,He=Object.getOwnPropertySymbols,dr=Object.prototype.hasOwnProperty,mr=Object.prototype.propertyIsEnumerable,ze=(s,e,t)=>e in s?lr(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Qe=(s,e)=>{for(var t in e||(e={}))dr.call(e,t)&&ze(s,t,e[t]);if(He)for(var t of He(e))mr.call(e,t)&&ze(s,t,e[t]);return s},pr=(s,e)=>cr(s,ur(e)),gr=(s,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(s,e)).next())});const fr=()=>{const{formatMessage:s}=(0,j.useIntl)(),[e,t]=(0,r.useState)(!1),i=(0,m.useNotification)(),{lockApp:u,unlockApp:l}=(0,m.useOverlayBlocker)(),{params:{id:d}}=(0,R.useRouteMatch)(`/settings/${C.Z}/roles/:id`),{isLoading:a,routes:n}=Ve(),{role:c,onSubmitSucceeded:g,isLoading:P}=or(d),p=(0,r.useRef)(),O=y=>gr(void 0,null,function*(){u(),t(!0);try{const L=p.current.getPermissions();yield X.Z.put(`/${C.Z}/roles/${d}`,pr(Qe(Qe({},y),L),{users:[]})),g({name:y.name,description:y.description}),i({type:"success",message:{id:(0,$.Z)("Settings.roles.edited"),defaultMessage:"Role edited"}})}catch(L){ir.error(L),i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}t(!1),l()});return P?r.createElement(m.LoadingIndicatorPage,null):r.createElement(Z.o,null,r.createElement(m.SettingsPageTitle,{name:"Roles"}),r.createElement(ue.Formik,{enableReinitialize:!0,initialValues:{name:c.name,description:c.description},onSubmit:O,validationSchema:ar},({handleSubmit:y,values:L,handleChange:w,errors:k})=>r.createElement(m.Form,{noValidate:!0,onSubmit:y},r.createElement(v.T,{primaryAction:!a&&r.createElement(I.z,{disabled:c.code==="strapi-super-admin",type:"submit",loading:e,startIcon:r.createElement(pe.Z,null)},s({id:"global.save",defaultMessage:"Save"})),title:c.name,subtitle:c.description,navigationAction:r.createElement(m.Link,{startIcon:r.createElement(ft.Z,null),to:"/settings/users-permissions/roles"},s({id:"global.back",defaultMessage:"Back"}))}),r.createElement(D.D,null,r.createElement(A.K,{spacing:7},r.createElement(S.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},r.createElement(A.K,{spacing:4},r.createElement(f.Z,{variant:"delta",as:"h2"},s({id:(0,$.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),r.createElement(H.r,{gap:4},r.createElement(G.P,{col:6},r.createElement(de.o,{name:"name",value:L.name||"",onChange:w,label:s({id:"global.name",defaultMessage:"Name"}),error:k.name?s({id:k.name,defaultMessage:"Invalid value"}):null})),r.createElement(G.P,{col:6},r.createElement(me.g,{name:"description",value:L.description||"",onChange:w,label:s({id:"global.description",defaultMessage:"Description"}),error:k.description?s({id:k.description,defaultMessage:"Invalid value"}):null}))))),!a&&r.createElement(Ne,{ref:p,permissions:c.permissions,routes:n}))))))},Pr=()=>r.createElement(m.CheckPagePermissions,{permissions:b.Z.updateRole},r.createElement(fr,null)),vr=V.Ry().shape({name:V.Z_().required(m.translatedErrors.required),description:V.Z_().required(m.translatedErrors.required)});var Er=o(98399),hr=Object.defineProperty,yr=Object.defineProperties,Or=Object.getOwnPropertyDescriptors,Xe=Object.getOwnPropertySymbols,Rr=Object.prototype.hasOwnProperty,Cr=Object.prototype.propertyIsEnumerable,Ye=(s,e,t)=>e in s?hr(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Je=(s,e)=>{for(var t in e||(e={}))Rr.call(e,t)&&Ye(s,t,e[t]);if(Xe)for(var t of Xe(e))Cr.call(e,t)&&Ye(s,t,e[t]);return s},br=(s,e)=>yr(s,Or(e)),Dr=(s,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(s,e)).next())});const Tr=()=>{const{formatMessage:s}=(0,j.useIntl)(),[e,t]=(0,r.useState)(!1),i=(0,m.useNotification)(),{goBack:u}=(0,R.useHistory)(),{lockApp:l,unlockApp:d}=(0,m.useOverlayBlocker)(),{isLoading:a,permissions:n,routes:c}=Ve(),{trackUsage:g}=(0,m.useTracking)(),P=(0,r.useRef)(),p=O=>Dr(void 0,null,function*(){l(),t(!0);try{const y=P.current.getPermissions();yield X.Z.post(`/${C.Z}/roles`,br(Je(Je({},O),y),{users:[]})),g("didCreateRole"),i({type:"success",message:{id:(0,$.Z)("Settings.roles.created"),defaultMessage:"Role created"}}),u()}catch(y){Er.error(y),i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}t(!1),d()});return r.createElement(Z.o,null,r.createElement(m.SettingsPageTitle,{name:"Roles"}),r.createElement(ue.Formik,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:p,validationSchema:vr},({handleSubmit:O,values:y,handleChange:L,errors:w})=>r.createElement(m.Form,{noValidate:!0,onSubmit:O},r.createElement(v.T,{primaryAction:!a&&r.createElement(I.z,{type:"submit",loading:e,startIcon:r.createElement(pe.Z,null)},s({id:"global.save",defaultMessage:"Save"})),title:s({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:s({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),r.createElement(D.D,null,r.createElement(A.K,{spacing:7},r.createElement(S.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},r.createElement(A.K,{spacing:4},r.createElement(f.Z,{variant:"delta",as:"h2"},s({id:(0,$.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),r.createElement(H.r,{gap:4},r.createElement(G.P,{col:6},r.createElement(de.o,{name:"name",value:y.name||"",onChange:L,label:s({id:"global.name",defaultMessage:"Name"}),error:w.name?s({id:w.name,defaultMessage:"Invalid value"}):null})),r.createElement(G.P,{col:6},r.createElement(me.g,{name:"description",value:y.description||"",onChange:L,label:s({id:"global.description",defaultMessage:"Description"}),error:w.description?s({id:w.description,defaultMessage:"Invalid value"}):null}))))),!a&&r.createElement(Ne,{ref:P,permissions:n,routes:c}))))))},Ar=()=>r.createElement(m.CheckPagePermissions,{permissions:b.Z.createRole},r.createElement(Tr,null)),Lr=()=>r.createElement(m.CheckPagePermissions,{permissions:b.Z.accessRoles},r.createElement(R.Switch,null,r.createElement(R.Route,{path:`/settings/${C.Z}/roles/new`,component:Ar,exact:!0}),r.createElement(R.Route,{path:`/settings/${C.Z}/roles/:id`,component:Pr,exact:!0}),r.createElement(R.Route,{path:`/settings/${C.Z}/roles`,component:gt,exact:!0}),r.createElement(R.Route,{path:"",component:m.NotFound})))},8917:(re,F,o)=>{o.d(F,{Z:()=>K});var r=o(43653),R=o.n(r),m=o(88425),C=o.n(m),b=(v,T,D)=>new Promise((Z,N)=>{var _=U=>{try{E(D.next(U))}catch(f){N(f)}},x=U=>{try{E(D.throw(U))}catch(f){N(f)}},E=U=>U.done?Z(U.value):Promise.resolve(U.value).then(_,x);E((D=D.apply(v,T)).next())});const I=R().create({baseURL:"http://localhost:1337"});I.interceptors.request.use(v=>b(void 0,null,function*(){return v.headers={Authorization:`Bearer ${m.auth.getToken()}`,Accept:"application/json","Content-Type":"application/json"},v}),v=>{Promise.reject(v)}),I.interceptors.response.use(v=>v,v=>{var T;throw((T=v.response)==null?void 0:T.status)===401&&(m.auth.clearAppStorage(),window.location.reload()),v});const K=I},59677:(re,F,o)=>{o.d(F,{be:()=>r.Z,YX:()=>C,Gc:()=>K,OB:()=>v.Z});var r=o(8917),R=o(92891);const C=T=>Object.keys(T).reduce((D,Z)=>{const N=T[Z].controllers,_=Object.keys(N).reduce((x,E)=>((0,R.isEmpty)(N[E])||(x[E]=N[E]),x),{});return(0,R.isEmpty)(_)||(D[Z]={controllers:_}),D},{});var b=o(90201);const K=T=>`/${b.Z}/${T}`;var v=o(82069)}}]);
